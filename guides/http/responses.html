<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>HTTP Responses </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="HTTP Responses ">
    <meta name="generator" content="docfx 2.40.8.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" width="56" height="52" src="../../images/largeLogo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="http-responses">HTTP Responses</h1>

<p>By default the framework will return a 200 status code and the command response as the body, unless an exceptioon occurs in which case a 500 error will be returned.</p>
<p>The response can be shaped and influenced by registering response handlers against functions. Response handlers must implement the <em>IHttpResponseHandler</em> interface as shown in the example below that will return a 204 no content response when a command result is null:</p>
<pre><code>public class CustomResponseHandler : IHttpResponseHandler
{
    // Handle responses for errors
    public Task&lt;IActionResult&gt; CreateResponse&lt;TCommand&gt;(TCommand command, Exception ex) where TCommand : ICommand
    {
        return null;
    }

    // Handle responses for commands with results
    public Task&lt;IActionResult&gt; CreateResponse&lt;TCommand, TResult&gt;(TCommand command, TResult result) where TCommand : ICommand&lt;TResult&gt;
    {
        if (result == null)
        {
            return Task.FromResult((IActionResult)new NoContentResult());
        }

        return null;
    }

    // Handle responses for commands with no results
    public Task&lt;IActionResult&gt; CreateResponse&lt;TCommand&gt;(TCommand command)
    {
        return null;
    }
}
</code></pre><p>To have Function Monkey handle the response in the default manner simply return either a null task or a task with a null result. In the example above, for example, error handling will be handled as per usual by Function Monkey.</p>
<p>To register this handler on a per function basis use the <em>ResponseHandler</em> method as shown in the example below:</p>
<pre><code>public class FunctionAppConfiguration : IFunctionAppConfiguration
{
    public void Build(IFunctionHostBuilder builder)
    {
        builder
            .Setup((serviceCollection, commandRegistry) =&gt;
            {
                commandRegistry.Register&lt;InvoiceQueryHandler&gt;();
            })
            .Functions(functions =&gt; functions
                .HttpRoute(&quot;/Invoice&quot;, route =&gt; route
                    .HttpFunction&lt;InvoiceQuery&gt;(HttpMethod.Get)
                        .Options(options =&gt; options.ResponseHandler&lt;CustomResponseHandler&gt;())
                )
            );
    }
}
</code></pre><p>Alternatively a response handler can be registered as a default handler:</p>
<pre><code>public class FunctionAppConfiguration : IFunctionAppConfiguration
{
    public void Build(IFunctionHostBuilder builder)
    {
        builder
            .Setup((serviceCollection, commandRegistry) =&gt;
            {
                commandRegistry.Register&lt;InvoiceQueryHandler&gt;();
            })
            .DefaultHttpResponseHandler&lt;CustomResponseHandler&gt;()
            .Functions(functions =&gt; functions
                .HttpRoute(&quot;/Invoice&quot;, route =&gt; route
                    .HttpFunction&lt;InvoiceQuery&gt;(HttpMethod.Get)
                )
            );
    }
}
</code></pre><p>In keeping with Function Monkeys goals of cleanly separating protocol from business logic HTTP response handling is ideally kept separate to command handlers using this method. If you do need to implement response handling from within a command handler then the suggestion is to introduce an interface on a response like the below:</p>
<pre><code>public interface IHttpResult
{        
    int StatusCode { get; set; }
}
</code></pre><p>And then on a response model implement this as an explicit interface:</p>
<pre><code>public class MyCommandResponse : IHttpResult
{
    public string SomeProperty { get; set; }

    int IHttpResult.StatusCode { get; set;}
}
</code></pre><p>The response handler can then look for this interface and behave accordingly:</p>
<pre><code>public class CustomResponseHandler : IHttpResponseHandler
{
    public Task&lt;IActionResult&gt; CreateResponse&lt;TCommand&gt;(TCommand command, Exception ex) where TCommand : ICommand
    {
        return null;
    }

    public Task&lt;IActionResult&gt; CreateResponse&lt;TCommand, TResult&gt;(TCommand command, TResult result) where TCommand : ICommand&lt;TResult&gt;
    {
        if (result is IHttpResult httpResult)
        {
            return Task.FromResult((IActionResult)new StatusCodeResult(httpResult.StatusCode));
        }

        return null;
    }

    // Handle responses for commands with no results
    public Task&lt;IActionResult&gt; CreateResponse&lt;TCommand&gt;(TCommand command)
    {
        return null;
    }
}
</code></pre><div id="disqus_thread"></div>
            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/JamesRandall/FunctionMonkey/blob/master/docfx/guides/http/responses.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                  <li>
                    <a href="#disqus_thread" class="contribution-link">0 Comments</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright © 2018 James Randall
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
    <script id="dsq-count-scr" src="//docfx-github.disqus.com/count.js" async=""></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-20735760-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-20735760-7');
    </script>
    
    <script defer="" src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>  </body>
</html>
