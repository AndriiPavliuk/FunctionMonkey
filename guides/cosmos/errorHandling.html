<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Error Handling </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Error Handling ">
    <meta name="generator" content="docfx 2.40.2.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" width="56" height="52" src="../../images/largeLogo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="error-handling">Error Handling</h1>

<p>Unless you use the <em>ICosmosDbDocumentBatchCommand</em> interface on your commands then Function Monkey will process batches of documents in the order they are recieved - one invocation of your function may contain multiple documents.</p>
<p>If an error occurs, either in the Function Monkey wrapper or due to an exception thrown from your command handler, then the default behaviour is to log an error along with the document ID and continue to process documents.</p>
<p>You can extend and modify this behaviour by implementing and registering an instance of the <em>ICosmosDbErrorHandler</em> interface. This will allow you to take additional steps (for example initiate some form of retry), log information yourself, and stop the processing of the current batch.</p>
<p>The example implementation below logs a warning and allows processing of the current batch to continue:</p>
<pre><code>public class ExampleCosmosErrorHandler : ICosmosDbErrorHandler
{
    private readonly ILogger&lt;ExampleCosmosErrorHandler&gt; _logger;

    public ExampleCosmosErrorHandler(ILogger&lt;ExampleCosmosErrorHandler&gt; logger)
    {
        _logger = logger;
    }

    public Task&lt;bool&gt; HandleError(Exception ex, Document document)
    {
        _logger.LogWarning(ex, &quot;Ooops&quot;);
        return Task.FromResult(true); // return false to stop the processing of the current batch
    }
}
</code></pre><p>This can be registered on a per function basis as shown in the example configuration block below:</p>
<pre><code>public class FunctionAppConfiguration : IFunctionAppConfiguration
{
    private const string CosmosDatabaseName = &quot;Financials&quot;;
    private const string CosmosCollectionName = &quot;Invoices&quot;;
    private const string CosmosConnectionSettingName = &quot;cosmosDbConnection&quot;;

    public void Build(IFunctionHostBuilder builder)
    {
        builder
            .Setup((serviceCollection, commandRegistry) =&gt;
                commandRegistry.Register&lt;InvoiceUpdatedCommandHandler&gt;()
            )
            .Functions(functions =&gt; functions
                .CosmosDb(CosmosConnectionSettingName, cosmos =&gt; cosmos
                    .ChangeFeedFunction&lt;InvoiceUpdatedCommand, ExampleCosmosErrorHandler&gt;(CosmosCollectionName, CosmosDatabaseName, convertToPascalCase:true)
                )
            );
    }
}
</code></pre><div id="disqus_thread"></div>
            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/JamesRandall/FunctionMonkey/blob/master/docfx/guides/cosmos/errorHandling.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                  <li>
                    <a href="#disqus_thread" class="contribution-link">0 Comments</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright © 2018 James Randall
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
    <script id="dsq-count-scr" src="//docfx-github.disqus.com/count.js" async=""></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-20735760-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-20735760-7');
    </script>
    
    <script defer="" src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>  </body>
</html>
